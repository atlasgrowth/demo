<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ prospect.name }} - Professional Services</title>
    
    <!-- Fonts and Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    {% if prospect.status == 'converted' %}
    <!-- Additional resources for converted clients -->
    {% if client_settings.enable_online_payments %}
    <script src="https://js.stripe.com/v3/"></script>
    {% endif %}
    {% endif %}
    
    <style>
        :root {
            --primary-color: {{ prospect.primary_color|default:"#336699" }};
            --secondary-color: {{ prospect.secondary_color|default:"#66aacc" }};
            --primary-dark: {{ prospect.primary_color|default:"#336699" }}dd;
            --text-color: #333;
            --light-bg: #f8f9fa;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            color: var(--text-color);
            line-height: 1.6;
        }
        
        /* Navigation */
        .navbar {
            background-color: white;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
        }
        
        .navbar-brand {
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .nav-link {
            font-weight: 500;
            color: #555;
            margin: 0 10px;
            transition: color 0.3s;
        }
        
        .nav-link:hover, .nav-link.active {
            color: var(--primary-color);
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 80px 0;
            position: relative;
            overflow: hidden;
        }
        
        .hero::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('https://images.unsplash.com/photo-1567496898669-ee935f5f647a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTF8fHRlY2huaWNpYW58ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=1000&q=60') center center;
            background-size: cover;
            opacity: 0.1;
            z-index: 0;
        }
        
        .hero-content {
            position: relative;
            z-index: 1;
        }
        
        .hero h1 {
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        .hero p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 30px;
        }
        
        /* Call to Action Buttons */
        .btn-primary {
            background-color: white;
            color: var(--primary-color);
            border: none;
            padding: 12px 30px;
            font-weight: 600;
            border-radius: 50px;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            background-color: rgba(255, 255, 255, 0.9);
            color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-outline-primary {
            background-color: transparent;
            color: white;
            border: 2px solid white;
            padding: 12px 30px;
            font-weight: 600;
            border-radius: 50px;
            transition: all 0.3s;
        }
        
        .btn-outline-primary:hover {
            background-color: white;
            color: var(--primary-color);
            transform: translateY(-2px);
        }
        
        /* Services Section */
        .services {
            padding: 80px 0;
            background-color: var(--light-bg);
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 50px;
            position: relative;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background-color: var(--primary-color);
        }
        
        .service-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            height: 100%;
        }
        
        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .service-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        
        /* About Section */
        .about {
            padding: 80px 0;
        }
        
        .about-img {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .about-img img {
            width: 100%;
            height: auto;
            transition: transform 0.5s;
        }
        
        .about-img:hover img {
            transform: scale(1.03);
        }
        
        .about-content h2 {
            margin-bottom: 25px;
            font-weight: 700;
            position: relative;
            display: inline-block;
        }
        
        .about-content h2::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 80px;
            height: 3px;
            background-color: var(--primary-color);
        }
        
        /* Reviews Section */
        .reviews {
            padding: 80px 0;
            background-color: var(--light-bg);
        }
        
        .review-card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            position: relative;
            margin-top: 30px;
        }
        
        .review-card::before {
            content: """;
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 60px;
            color: rgba(0, 0, 0, 0.1);
            font-family: Georgia, serif;
        }
        
        .rating {
            color: #FFD700;
            margin-bottom: 15px;
        }
        
        .reviewer-info {
            display: flex;
            align-items: center;
            margin-top: 20px;
        }
        
        .reviewer-name {
            font-weight: 600;
            margin-left: 10px;
        }
        
        /* Chat Widget Button */
        .chat-widget-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: var(--primary-color);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .chat-widget-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        /* Scheduling Section */
        .scheduling {
            padding: 80px 0;
        }
        
        .form-control {
            border-radius: 5px;
            padding: 12px;
            margin-bottom: 20px;
        }
        
        /* Footer */
        .footer {
            background-color: #273444;
            color: #B3C5D6;
            padding: 60px 0 30px;
        }
        
        .footer h5 {
            color: white;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .footer-links {
            list-style: none;
            padding: 0;
        }
        
        .footer-links li {
            margin-bottom: 10px;
        }
        
        .footer-links a {
            color: #B3C5D6;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-links a:hover {
            color: white;
        }
        
        .social-icons a {
            color: white;
            margin-right: 15px;
            font-size: 18px;
            transition: color 0.3s;
        }
        
        .social-icons a:hover {
            color: var(--primary-color);
        }
        
        .copyright {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 30px;
            padding-top: 20px;
        }
        
        /* Contact Info Cards */
        .contact-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
        }
        
        .contact-card i {
            font-size: 24px;
            color: var(--primary-color);
            margin-right: 15px;
        }
        
        /* Modal Styles */
        .modal-content {
            border-radius: 15px;
            border: none;
        }
        
        .modal-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 15px 15px 0 0;
        }
        
        .modal-title {
            font-weight: 600;
        }
        
        .modal-body {
            padding: 30px;
        }
        
        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .hero {
                padding: 60px 0;
            }
            
            .about, .services, .reviews, .scheduling {
                padding: 60px 0;
            }
            
            .about-img {
                margin-bottom: 30px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Banner -->
    <div style="background-color: #336699; padding: 10px 0; text-align: center; color: white; font-weight: bold;">
        <a href="/business/login/?business={{ prospect.slug }}" style="color: white; text-decoration: none;">
            Business Owner? <span style="background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 4px; margin-left: 10px;">CLICK HERE TO LOGIN</span>
        </a>
    </div>
    
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                {{ prospect.name }}
                {% if prospect.status == 'converted' %}
                <span class="badge bg-success ms-2">Premium</span>
                {% endif %}
            </a>
            
            <!-- Always visible login button -->
            <a class="btn btn-primary d-lg-none me-2" href="/business/login/?business={{ prospect.slug }}">
                <i class="fas fa-user-lock"></i> Login
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#home">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#services">Services</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#reviews">Reviews</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#contact">Contact</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#schedule" data-bs-toggle="modal" data-bs-target="#scheduleModal">Schedule</a>
                    </li>
                    <!-- Desktop login button -->
                    <li class="nav-item ms-lg-3 d-none d-lg-block">
                        <a class="btn btn-primary px-3 py-2" href="/business/login/?business={{ prospect.slug }}" style="font-weight: 600;">
                            <i class="fas fa-user-lock me-1"></i> Business Login
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="container hero-content text-center">
            <h1 class="display-4">{{ prospect.name }}</h1>
            <p class="lead">
                {% if prospect.business_type %}
                    Professional {{ prospect.business_type }} services in {{ prospect.city }}, {{ prospect.state }}
                {% else %}
                    Professional services in {{ prospect.city }}, {{ prospect.state }}
                {% endif %}
            </p>
            <div>
                <button class="btn btn-primary me-3" data-bs-toggle="modal" data-bs-target="#scheduleModal">Schedule Appointment</button>
                <a href="#contact" class="btn btn-outline-primary">Contact Us</a>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section class="services" id="services">
        <div class="container">
            <h2 class="section-title">Our Services</h2>
            <div class="row g-4">
                <!-- Service 1 -->
                <div class="col-md-4">
                    <div class="service-card p-4 text-center">
                        <div class="service-icon">
                            <i class="fas fa-tools"></i>
                        </div>
                        <h4>Repair & Maintenance</h4>
                        <p>Professional repair and maintenance services to keep your systems running efficiently.</p>
                    </div>
                </div>
                
                <!-- Service 2 -->
                <div class="col-md-4">
                    <div class="service-card p-4 text-center">
                        <div class="service-icon">
                            <i class="fas fa-snowflake"></i>
                        </div>
                        <h4>New Installations</h4>
                        <p>Expert installation of new systems with top-quality equipment and materials.</p>
                    </div>
                </div>
                
                <!-- Service 3 -->
                <div class="col-md-4">
                    <div class="service-card p-4 text-center">
                        <div class="service-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <h4>Home Assessment</h4>
                        <p>Comprehensive assessment of your home's systems for optimal performance.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section class="about" id="about">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <div class="about-img">
                        {% if prospect.photo_url %}
                            <img src="{{ prospect.photo_url }}" alt="{{ prospect.name }}" class="img-fluid">
                        {% else %}
                            <img src="https://images.unsplash.com/photo-1581094794329-c8112a89af12?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8OHx8aHZhY3xlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=800&q=60" alt="{{ prospect.name }}" class="img-fluid">
                        {% endif %}
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="about-content mt-4 mt-lg-0">
                        <h2>About {{ prospect.name }}</h2>
                        <p>
                            {% if prospect.description %}
                                {{ prospect.description }}
                            {% else %}
                                With years of experience in the industry, {{ prospect.name }} has been providing top-quality services to {{ prospect.city }} and surrounding areas. Our team of certified professionals is dedicated to ensuring your complete satisfaction with every job we undertake.
                            {% endif %}
                        </p>
                        <p>We pride ourselves on our reliability, expertise, and commitment to customer service. When you choose {{ prospect.name }}, you're choosing a partner who will treat your home with respect and deliver exceptional results.</p>
                        
                        <div class="mt-4">
                            <div class="row">
                                <div class="col-6">
                                    <div class="d-flex align-items-center mb-3">
                                        <i class="fas fa-check-circle me-2" style="color: var(--primary-color);"></i>
                                        <span>Licensed & Insured</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="d-flex align-items-center mb-3">
                                        <i class="fas fa-check-circle me-2" style="color: var(--primary-color);"></i>
                                        <span>24/7 Emergency Service</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="d-flex align-items-center mb-3">
                                        <i class="fas fa-check-circle me-2" style="color: var(--primary-color);"></i>
                                        <span>Satisfaction Guaranteed</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="d-flex align-items-center mb-3">
                                        <i class="fas fa-check-circle me-2" style="color: var(--primary-color);"></i>
                                        <span>Free Estimates</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Reviews Section -->
    <section class="reviews" id="reviews">
        <div class="container">
            <h2 class="section-title">Customer Reviews</h2>
            
            <div class="d-flex justify-content-center align-items-center mb-5">
                <div class="text-center">
                    {% if prospect.rating %}
                    <div class="display-4 fw-bold">{{ prospect.rating }}</div>
                    <div class="rating mb-2">
                        {% for i in "12345" %}
                            {% if forloop.counter <= prospect.rating|floatformat:"0" %}
                                <i class="fas fa-star"></i>
                            {% elif forloop.counter <= prospect.rating|add:"0.5"|floatformat:"0" %}
                                <i class="fas fa-star-half-alt"></i>
                            {% else %}
                                <i class="far fa-star"></i>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <p>Based on {{ prospect.reviews_count }} reviews</p>
                    {% else %}
                    <div class="display-4 fw-bold">New</div>
                    <p>Be the first to leave a review!</p>
                    {% endif %}
                </div>
            </div>
            
            <div class="row">
                <!-- Review 1 -->
                <div class="col-md-4">
                    <div class="review-card">
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p>"Excellent service! The technician was professional, knowledgeable, and fixed our issue quickly. Highly recommend!"</p>
                        <div class="reviewer-info">
                            <span class="reviewer-name">Sarah Thompson</span>
                        </div>
                    </div>
                </div>
                
                <!-- Review 2 -->
                <div class="col-md-4">
                    <div class="review-card">
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                        </div>
                        <p>"Very pleased with the work done. Fair pricing and they completed the job on time. Will definitely use their services again."</p>
                        <div class="reviewer-info">
                            <span class="reviewer-name">Michael Johnson</span>
                        </div>
                    </div>
                </div>
                
                <!-- Review 3 -->
                <div class="col-md-4">
                    <div class="review-card">
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p>"Amazing customer service! From scheduling to completion, everything was handled professionally. The technician explained everything clearly."</p>
                        <div class="reviewer-info">
                            <span class="reviewer-name">Jennifer Davis</span>
                        </div>
                    </div>
                </div>
            </div>
            
            {% if prospect.reviews_link %}
            <div class="text-center mt-4">
                <a href="{{ prospect.reviews_link }}" target="_blank" class="btn btn-outline-dark">See All Reviews</a>
            </div>
            {% endif %}
        </div>
    </section>

    <!-- Contact Section -->
    <section class="contact py-5" id="contact">
        <div class="container">
            <h2 class="section-title">Contact Us</h2>
            
            <div class="row mt-5">
                <div class="col-lg-6">
                    <div class="contact-info">
                        {% if prospect.phone %}
                        <div class="contact-card">
                            <i class="fas fa-phone-alt"></i>
                            <div>
                                <h5 class="mb-0">Phone</h5>
                                <p class="mb-0">{{ prospect.phone }}</p>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if prospect.email %}
                        <div class="contact-card">
                            <i class="fas fa-envelope"></i>
                            <div>
                                <h5 class="mb-0">Email</h5>
                                <p class="mb-0">{{ prospect.email }}</p>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if prospect.address %}
                        <div class="contact-card">
                            <i class="fas fa-map-marker-alt"></i>
                            <div>
                                <h5 class="mb-0">Address</h5>
                                <p class="mb-0">{{ prospect.address }}</p>
                            </div>
                        </div>
                        {% endif %}
                        
                        <div class="contact-card">
                            <i class="fas fa-clock"></i>
                            <div>
                                <h5 class="mb-0">Business Hours</h5>
                                <p class="mb-0">
                                    {% if prospect.hours %}
                                        Monday-Friday: 8:00 AM - 6:00 PM<br>
                                        Saturday: 9:00 AM - 4:00 PM<br>
                                        Sunday: Closed
                                    {% else %}
                                        Monday-Friday: 8:00 AM - 6:00 PM<br>
                                        Saturday: 9:00 AM - 4:00 PM<br>
                                        Sunday: Closed
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6 mt-4 mt-lg-0">
                    <form class="contact-form bg-white p-4 rounded shadow-sm">
                        <div class="mb-3">
                            <label for="name" class="form-label">Your Name</label>
                            <input type="text" class="form-control" id="name" placeholder="Enter your name">
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="email" placeholder="Enter your email">
                        </div>
                        <div class="mb-3">
                            <label for="phone" class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="phone" placeholder="Enter your phone number">
                        </div>
                        <div class="mb-3">
                            <label for="message" class="form-label">Message</label>
                            <textarea class="form-control" id="message" rows="4" placeholder="How can we help you?"></textarea>
                        </div>
                        <button type="submit" class="btn w-100" style="background-color: var(--primary-color); color: white;">Send Message</button>
                        
                        {% if prospect.status == 'converted' and client_settings %}
                        <div class="mt-3">
                            {% if client_settings.enable_online_payments %}
                            <div class="d-flex align-items-center mb-2">
                                <span class="badge bg-success me-2">Premium Feature</span>
                                <span><i class="fas fa-credit-card me-1"></i> Online Payments Available</span>
                            </div>
                            {% endif %}
                            
                            {% if client_settings.enable_sms_notifications %}
                            <div class="d-flex align-items-center mb-2">
                                <span class="badge bg-success me-2">Premium Feature</span>
                                <span><i class="fas fa-sms me-1"></i> SMS Notifications</span>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4 mb-lg-0">
                    <h5>{{ prospect.name }}</h5>
                    <p>
                        {% if prospect.business_type %}
                            Professional {{ prospect.business_type }} services with a commitment to quality and customer satisfaction.
                        {% else %}
                            Professional services with a commitment to quality and customer satisfaction.
                        {% endif %}
                    </p>
                    <div class="social-icons">
                        {% if prospect.facebook %}
                        <a href="{{ prospect.facebook }}" target="_blank"><i class="fab fa-facebook-f"></i></a>
                        {% else %}
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        {% endif %}
                        
                        {% if prospect.twitter %}
                        <a href="{{ prospect.twitter }}" target="_blank"><i class="fab fa-twitter"></i></a>
                        {% else %}
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        {% endif %}
                        
                        {% if prospect.instagram %}
                        <a href="{{ prospect.instagram }}" target="_blank"><i class="fab fa-instagram"></i></a>
                        {% else %}
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        {% endif %}
                    </div>
                </div>
                
                <div class="col-lg-4 mb-4 mb-lg-0">
                    <h5>Quick Links</h5>
                    <ul class="footer-links">
                        <li><a href="#home">Home</a></li>
                        <li><a href="#services">Services</a></li>
                        <li><a href="#about">About Us</a></li>
                        <li><a href="#reviews">Reviews</a></li>
                        <li><a href="#contact">Contact</a></li>
                    </ul>
                </div>
                
                <div class="col-lg-4">
                    <h5>Service Areas</h5>
                    <p>
                        {% if prospect.city and prospect.state %}
                            Serving {{ prospect.city }}, {{ prospect.state }} and surrounding areas.
                        {% else %}
                            Serving local areas with prompt and reliable service.
                        {% endif %}
                    </p>
                    <a href="#schedule" class="btn btn-light" data-bs-toggle="modal" data-bs-target="#scheduleModal">Schedule Now</a>
                </div>
            </div>
            
            <div class="text-center copyright">
                <p>&copy; 2025 {{ prospect.name }}. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Schedule Modal -->
    <div class="modal fade" id="scheduleModal" tabindex="-1" aria-labelledby="scheduleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="scheduleModalLabel">Schedule an Appointment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="appointmentForm" class="row g-3">
                        <div class="col-md-6">
                            <label for="fullName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="fullName" required>
                        </div>
                        <div class="col-md-6">
                            <label for="phoneNumber" class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="phoneNumber" required>
                        </div>
                        <div class="col-md-6">
                            <label for="emailAddress" class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="emailAddress" required>
                        </div>
                        <div class="col-md-6">
                            <label for="serviceType" class="form-label">Service Type</label>
                            <select class="form-select" id="serviceType" required>
                                <option value="" selected disabled>Select a service</option>
                                <option value="repair">Repair & Maintenance</option>
                                <option value="installation">New Installation</option>
                                <option value="assessment">Home Assessment</option>
                                <option value="emergency">Emergency Service</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="preferredDate" class="form-label">Preferred Date</label>
                            <input type="date" class="form-control" id="preferredDate" required>
                        </div>
                        <div class="col-md-6">
                            <label for="preferredTime" class="form-label">Preferred Time</label>
                            <select class="form-select" id="preferredTime" required>
                                <option value="" selected disabled>Select a time</option>
                                <option value="morning">Morning (8:00 AM - 12:00 PM)</option>
                                <option value="afternoon">Afternoon (12:00 PM - 4:00 PM)</option>
                                <option value="evening">Evening (4:00 PM - 7:00 PM)</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label for="serviceAddress" class="form-label">Service Address</label>
                            <input type="text" class="form-control" id="serviceAddress" required>
                        </div>
                        <div class="col-12">
                            <label for="serviceNotes" class="form-label">Additional Notes</label>
                            <textarea class="form-control" id="serviceNotes" rows="3"></textarea>
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn w-100" style="background-color: var(--primary-color); color: white;">Submit Appointment Request</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Widget Button -->
    <div class="chat-widget-btn" data-bs-toggle="modal" data-bs-target="#chatModal" style="bottom: 100px;">
        <i class="fas fa-comments"></i>
    </div>
    
    <!-- Floating Login Button -->
    <a href="/business/login/?business={{ prospect.slug }}" class="chat-widget-btn" style="background-color: #28a745;">
        <i class="fas fa-user-lock"></i>
    </a>

    <!-- Chat Modal -->
    <div class="modal fade" id="chatModal" tabindex="-1" aria-labelledby="chatModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="chatModalLabel">Chat with {{ prospect.name }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="height: 300px; overflow-y: auto;">
                    <div class="chat-messages">
                        <div class="message business mb-3">
                            <div class="message-content p-3 rounded" style="background-color: #f0f0f0;">
                                <p class="mb-0">Hello! How can we help you today?</p>
                            </div>
                            <div class="message-time text-muted small mt-1">10:00 AM</div>
                        </div>
                        <!-- Demo messages will be added here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Type your message..." id="chatInput">
                        <button class="btn" style="background-color: var(--primary-color); color: white;" id="sendChat">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Appointment form submission
        document.getElementById('appointmentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Collect form data
            const formData = {
                fullName: document.getElementById('fullName').value,
                phoneNumber: document.getElementById('phoneNumber').value,
                emailAddress: document.getElementById('emailAddress').value,
                serviceType: document.getElementById('serviceType').value,
                preferredDate: document.getElementById('preferredDate').value,
                preferredTime: document.getElementById('preferredTime').value,
                serviceAddress: document.getElementById('serviceAddress').value,
                serviceNotes: document.getElementById('serviceNotes').value
            };
            
            // Send data to the API
            fetch('/api/{{ prospect.slug }}/schedule/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Display a success message
                    alert('Thank you for scheduling an appointment! We will contact you shortly to confirm.');
                    
                    // Close the modal
                    var scheduleModal = bootstrap.Modal.getInstance(document.getElementById('scheduleModal'));
                    scheduleModal.hide();
                    
                    // Reset form
                    document.getElementById('appointmentForm').reset();
                } else {
                    alert('Error: ' + (data.error || 'Something went wrong.'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error: ' + error.message);
            });
        });
        
        // Track if this is first message in conversation
        let isFirstMessage = true;
        let currentConversationId = null;
        let customerInfo = {
            name: '',
            email: '',
            phone: '',
            address: '',
            is_existing_customer: false
        };
        
        // Chat functionality
        document.getElementById('sendChat').addEventListener('click', function() {
            var chatInput = document.getElementById('chatInput');
            var message = chatInput.value.trim();
            
            if (message) {
                // Add customer message to UI
                addMessage(message, 'customer');
                chatInput.value = '';
                
                // Send message to API
                fetch('/api/{{ prospect.slug }}/send-message/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        sender_type: 'customer',
                        sender_name: customerInfo.name || 'Website Visitor',
                        message: message,
                        conversation_id: currentConversationId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (!data.success) {
                        console.error('Error sending message:', data.error);
                        return;
                    }
                    
                    // Save conversation ID
                    currentConversationId = data.conversation_id;
                    
                    // If first message, show contact info form
                    if (isFirstMessage) {
                        isFirstMessage = false;
                        
                        // Send welcome message
                        setTimeout(function() {
                            const welcomeMessage = "Thank you for contacting {{ prospect.name }}! To help us serve you better, could you please provide some information?";
                            addMessage(welcomeMessage, 'business');
                            
                            // Store business response in API
                            fetch('/api/{{ prospect.slug }}/send-message/', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    sender_type: 'business',
                                    sender_name: '{{ prospect.name }}',
                                    message: welcomeMessage,
                                    conversation_id: data.conversation_id
                                })
                            });
                            
                            // Show contact form as a message
                            setTimeout(function() {
                                // Create contact form message
                                const formHtml = `
                                    <div class="contact-form bg-white p-3 rounded">
                                        <div class="mb-2">
                                            <label class="form-label mb-1 small fw-bold">First Name*</label>
                                            <input type="text" id="chat-first-name" class="form-control form-control-sm" required>
                                        </div>
                                        <div class="mb-2">
                                            <label class="form-label mb-1 small fw-bold">Last Name*</label>
                                            <input type="text" id="chat-last-name" class="form-control form-control-sm" required>
                                        </div>
                                        <div class="mb-2">
                                            <label class="form-label mb-1 small fw-bold">Email Address*</label>
                                            <input type="email" id="chat-email" class="form-control form-control-sm" required>
                                        </div>
                                        <div class="mb-2">
                                            <label class="form-label mb-1 small fw-bold">Phone Number*</label>
                                            <input type="tel" id="chat-phone" class="form-control form-control-sm" required>
                                        </div>
                                        <div class="mb-2">
                                            <label class="form-label mb-1 small fw-bold">Address</label>
                                            <input type="text" id="chat-address" class="form-control form-control-sm">
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="chat-existing-customer">
                                                <label class="form-check-label small" for="chat-existing-customer">
                                                    I've used {{ prospect.name }} services before
                                                </label>
                                            </div>
                                        </div>
                                        <button id="submit-chat-info" class="btn btn-primary btn-sm w-100">Submit Information</button>
                                    </div>
                                `;
                                
                                // Add the form as a special message
                                addCustomHtmlMessage(formHtml, 'business');
                                
                                // Add form submission handler
                                document.getElementById('submit-chat-info').addEventListener('click', function() {
                                    const firstName = document.getElementById('chat-first-name').value.trim();
                                    const lastName = document.getElementById('chat-last-name').value.trim();
                                    const email = document.getElementById('chat-email').value.trim();
                                    const phone = document.getElementById('chat-phone').value.trim();
                                    
                                    // Simple validation
                                    if (!firstName || !lastName || !email || !phone) {
                                        alert('Please fill out all required fields');
                                        return;
                                    }
                                    
                                    // Save customer info
                                    customerInfo = {
                                        firstName: firstName,
                                        lastName: lastName,
                                        name: firstName + ' ' + lastName,
                                        email: email,
                                        phone: phone,
                                        address: document.getElementById('chat-address').value.trim(),
                                        is_existing_customer: document.getElementById('chat-existing-customer').checked
                                    };
                                    
                                    // Create a summary message to store in the chat log
                                    const infoSummary = `
                                        Customer Information:
                                        Name: ${customerInfo.name}
                                        Email: ${customerInfo.email}
                                        Phone: ${customerInfo.phone}
                                        Address: ${customerInfo.address || 'Not provided'}
                                        Existing Customer: ${customerInfo.is_existing_customer ? 'Yes' : 'No'}
                                    `;
                                    
                                    // Store this in the API as a system message and create a contact record
                                    fetch('/api/{{ prospect.slug }}/send-message/', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        },
                                        body: JSON.stringify({
                                            sender_type: 'system',
                                            sender_name: 'System',
                                            message: infoSummary,
                                            conversation_id: data.conversation_id,
                                            contact_info: {
                                                name: customerInfo.name,
                                                email: customerInfo.email,
                                                phone: customerInfo.phone,
                                                address: customerInfo.address,
                                                is_existing_customer: customerInfo.is_existing_customer
                                            }
                                        })
                                    });
                                    
                                    // Send thank you message and ask for additional information
                                    const thankYouMsg = `Thank you, ${customerInfo.firstName}! Is there anything specific you'd like us to know about your service needs?`;
                                    addMessage(thankYouMsg, 'business');
                                    
                                    // Store business response in API
                                    fetch('/api/{{ prospect.slug }}/send-message/', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        },
                                        body: JSON.stringify({
                                            sender_type: 'business',
                                            sender_name: '{{ prospect.name }}',
                                            message: thankYouMsg,
                                            conversation_id: data.conversation_id
                                        })
                                    });
                                    
                                    // Enable input for further conversation
                                    document.getElementById('chatInput').disabled = false;
                                    document.getElementById('sendChat').disabled = false;
                                    document.getElementById('chatInput').focus();
                                });
                                
                                // Disable regular chat input until form is submitted
                                document.getElementById('chatInput').disabled = true;
                                document.getElementById('sendChat').disabled = true;
                            }, 1000);
                        }, 1000);
                    } else {
                        // Not first message, send normal response
                        setTimeout(function() {
                            let response;
                            
                            // Check if this is right after form submission
                            if (customerInfo.name && !document.getElementById('chatInput').disabled) {
                                // Add this message as a note to the contact
                                fetch('/api/{{ prospect.slug }}/send-message/', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({
                                        sender_type: 'system',
                                        sender_name: 'System',
                                        message: `Additional notes from customer: ${message}`,
                                        conversation_id: data.conversation_id,
                                        add_to_contact_notes: true,
                                        contact_info: {
                                            name: customerInfo.name,
                                            email: customerInfo.email,
                                            phone: customerInfo.phone
                                        }
                                    })
                                });
                                
                                response = `Thank you for the additional information, ${customerInfo.firstName}. Our team will review this and get back to you soon.`;
                            } else {
                                const responses = [
                                    "Thank you for your message! Our team will get back to you soon.",
                                    "We've received your message and will respond as quickly as possible.",
                                    "Thanks for reaching out! We'll have someone from our team contact you shortly."
                                ];
                                response = responses[Math.floor(Math.random() * responses.length)];
                            }
                            
                            // Add response to UI
                            addMessage(response, 'business');
                            
                            // Store business response in API
                            fetch('/api/{{ prospect.slug }}/send-message/', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    sender_type: 'business',
                                    sender_name: '{{ prospect.name }}',
                                    message: response,
                                    conversation_id: data.conversation_id
                                })
                            });
                        }, 1000);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }
        });
        
        // Allow pressing Enter to send a message
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('sendChat').click();
            }
        });
        
        // Function to add messages to the chat
        function addMessage(text, type) {
            var messagesDiv = document.querySelector('.chat-messages');
            var now = new Date();
            var time = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            var messageDiv = document.createElement('div');
            messageDiv.className = 'message ' + type + ' mb-3';
            
            var messageClass = type === 'business' ? 'background-color: #f0f0f0;' : 'background-color: var(--primary-color); color: white;';
            var alignment = type === 'business' ? '' : 'margin-left: auto; max-width: 80%;';
            
            messageDiv.innerHTML = `
                <div class="message-content p-3 rounded" style="${messageClass} ${alignment}">
                    <p class="mb-0">${text}</p>
                </div>
                <div class="message-time text-muted small mt-1" style="${alignment}">${time}</div>
            `;
            
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        // Function to add custom HTML message (for forms)
        function addCustomHtmlMessage(html, type) {
            var messagesDiv = document.querySelector('.chat-messages');
            var now = new Date();
            var time = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            var messageDiv = document.createElement('div');
            messageDiv.className = 'message ' + type + ' mb-3';
            
            var alignment = type === 'business' ? '' : 'margin-left: auto; max-width: 80%;';
            
            messageDiv.innerHTML = `
                <div class="message-content rounded" style="${alignment}">
                    ${html}
                </div>
                <div class="message-time text-muted small mt-1" style="${alignment}">${time}</div>
            `;
            
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                var targetId = this.getAttribute('href');
                
                // Skip if it's a modal trigger
                if(this.hasAttribute('data-bs-toggle')) return;
                
                e.preventDefault();
                
                document.querySelector(targetId).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>